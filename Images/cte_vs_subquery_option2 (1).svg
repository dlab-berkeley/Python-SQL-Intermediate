<svg xmlns="http://www.w3.org/2000/svg" width="700" height="380" font-family="monospace" font-size="12">
<text x="10" y="42" font-weight="bold">Subquery (nested)</text><rect x="10" y="46" width="660" height="106" fill="none" stroke="#333"/><text xml:space="preserve" x="16" y="60">SELECT d.date, d.sales,</text><text xml:space="preserve" x="16" y="76">       (SELECT AVG(s2.sales)</text><text xml:space="preserve" x="16" y="92">        FROM sales s2</text><text xml:space="preserve" x="16" y="108">        WHERE s2.date BETWEEN DATE(d.date, &#x27;-6 day&#x27;) AND d.date) AS rolling_avg_7d</text><text xml:space="preserve" x="16" y="124">FROM sales d</text><text xml:space="preserve" x="16" y="140">ORDER BY d.date;</text>
<text x="350" y="200" font-family="sans-serif" font-size="12" text-anchor="middle">⇣ replace with ⇣</text>
<text x="10" y="222" font-weight="bold">CTE (readable)</text><rect x="10" y="226" width="660" height="106" fill="none" stroke="#333"/><text xml:space="preserve" x="16" y="240">WITH sales_7 AS (</text><text xml:space="preserve" x="16" y="256">      SELECT date, AVG(sales) OVER (ORDER BY date ROWS 6 PRECEDING) AS rolling_avg_7d</text><text xml:space="preserve" x="16" y="272">      FROM sales)</text><text xml:space="preserve" x="16" y="288">SELECT date, sales, rolling_avg_7d</text><text xml:space="preserve" x="16" y="304">FROM sales_7</text><text xml:space="preserve" x="16" y="320">ORDER BY date;</text>
</svg>